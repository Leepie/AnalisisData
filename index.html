<!DOCTYPE html>
<!-- 
KEMASKINI:
06.09.2025 - JAM 10:14PM 
-->

<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <title>Demo Mini Analisis</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="p-6 bg-gray-50 text-gray-800">
  <h1 class="text-xl font-bold mb-4">Demo Mini Analisis</h1>
  <button onclick="generateOverallAnalysis()" class="bg-blue-600 text-white px-4 py-2 rounded">Jana Analisis</button>

  <div class="mt-6 grid grid-cols-3 gap-4">
    <div class="bg-blue-500 text-white p-4 rounded">GPS: <span id="schoolGPS">--</span></div>
    <div class="bg-green-500 text-white p-4 rounded">Layak Sijil: <span id="footerCertificatePercent">--</span></div>
    <div class="bg-purple-500 text-white p-4 rounded">Jumlah Murid: <span id="studentCount">--</span></div>
  </div>

  <div class="mt-6">
    <h2 class="font-semibold">ðŸ“š Jadual Analisis Mata Pelajaran</h2>
    <table class="w-full text-sm border-collapse mt-2">
      <thead class="bg-green-600 text-white">
        <tr>
          <th class="px-2">Mata Pelajaran</th>
          <th class="px-2">Hadir</th>
          <th class="px-2">TH</th>
          <th class="px-2">A+</th>
          <th class="px-2">A</th>
          <th class="px-2">A-</th>
          <th class="px-2">B+</th>
          <th class="px-2">B</th>
          <th class="px-2">C+</th>
          <th class="px-2">C</th>
          <th class="px-2">D</th>
          <th class="px-2">E</th>
          <th class="px-2">G</th>
          <th class="px-2">%Lulus</th>
          <th class="px-2">%Gagal</th>
          <th class="px-2">GPMP</th>
        </tr>
      </thead>
      <tbody id="analisisSubjekBody" class="divide-y"></tbody>
    </table>
  </div>

  <script>
    const dummyCSV = `BIL,NO K/P,JANTINA,NAMA,KELAS,BM G,BI G,M G
1,990101-10-1234,L,Ali,5 STEMA,A,B+,A-
2,990202-10-5678,P,Siti,5 STEMA,B+,A,TH
3,990303-10-9999,L,Ahmad,5 STEMB,C,C+,B`;

    const gradeValueMapping = { "A+":0,"A":1,"A-":2,"B+":3,"B":4,"C+":5,"C":6,"D":7,"E":8,"G":9 };
    const gradeLabels = ["A+","A","A-","B+","B","C+","C","D","E","G"];
    let parsedData=[], subjectColumns=[];

    function parseCSV(csv){
      const lines=csv.trim().split('\n');
      const headers=lines[0].split(',').map(h=>h.trim());
      subjectColumns=headers.filter(h=>h.endsWith("G"));
      return lines.slice(1).map(line=>{
        const values=line.split(',');
        let obj={}; headers.forEach((h,i)=>obj[h]=values[i]?.trim()||'');
        return obj;
      });
    }

    parsedData=parseCSV(dummyCSV);

    function generateOverallAnalysis(){
      let jumlahMurid=0,jumlahGredNilai=0,jumlahSubjek=0,muridLayak=0;
      let subjectStats={};

      subjectColumns.forEach(sub=>{
        subjectStats[sub]={counts:Object.fromEntries(gradeLabels.map(g=>[g,0])),hadir:0,th:0,total:0};
      });

      parsedData.forEach(row=>{
        jumlahMurid++;
        let gredList=[];
        subjectColumns.forEach(sub=>{
          const g=row[sub]?.toUpperCase();
          if(gradeValueMapping.hasOwnProperty(g)){
            subjectStats[sub].counts[g]++; subjectStats[sub].hadir++;
            gredList.push(g); jumlahGredNilai+=gradeValueMapping[g]; jumlahSubjek++;
          } else if(g==="TH"){
            subjectStats[sub].th++;
          }
        });
        if(gredList.length>=2 && !gredList.includes("G")) muridLayak++;
      });

      document.getElementById("schoolGPS").textContent=(jumlahSubjek?(jumlahGredNilai/jumlahSubjek).toFixed(2):"--");
      document.getElementById("footerCertificatePercent").textContent=(jumlahMurid?((muridLayak/jumlahMurid)*100).toFixed(1)+"%":"--%");
      document.getElementById("studentCount").textContent=jumlahMurid;

      const body=document.getElementById("analisisSubjekBody"); body.innerHTML="";
      Object.keys(subjectStats).forEach(sub=>{
        const s=subjectStats[sub];
        const lulus=s.hadir-(s.counts["G"]||0);
        const gagal=(s.counts["G"]||0);
        const gpmp=s.hadir?(Object.entries(s.counts).reduce((a,[g,n])=>a+(gradeValueMapping[g]||0)*n,0)/s.hadir).toFixed(2):"--";
        body.innerHTML+=`
          <tr class="text-center">
            <td class="text-left font-medium">${sub}</td>
            <td class="text-blue-600">${s.hadir}</td>
            <td>${s.th}</td>
            ${gradeLabels.map(g=>`<td>${s.counts[g]}</td>`).join("")}
            <td class="text-green-600">${s.hadir?((lulus/s.hadir)*100).toFixed(1):0}%</td>
            <td class="text-red-600">${s.hadir?((gagal/s.hadir)*100).toFixed(1):0}%</td>
            <td class="font-bold">${gpmp}</td>
          </tr>`;
      });
    }
  </script>
</body>
</html>
